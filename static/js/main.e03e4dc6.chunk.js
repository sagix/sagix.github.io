(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,a){},108:function(e,t,a){e.exports=a.p+"static/media/logo.743ec13d.svg"},111:function(e,t,a){e.exports=a.p+"static/media/weather-night.eeafdbc3.svg"},112:function(e,t,a){e.exports=a.p+"static/media/weather-sunny.fb4f8a6b.svg"},113:function(e,t,a){e.exports=a.p+"static/media/weather-sunset-up.65e6d39d.svg"},114:function(e,t,a){e.exports=a.p+"static/media/weather-sunset-down.2a4daadf.svg"},115:function(e,t,a){e.exports=a.p+"static/media/weather-none.d2d3cc2f.svg"},116:function(e,t,a){e.exports=a.p+"static/media/empty.e1de1093.svg"},117:function(e,t,a){e.exports=a.p+"static/media/auto-fix.921a0631.svg"},119:function(e,t,a){e.exports=a(312)},128:function(e,t,a){},132:function(e,t,a){},133:function(e,t,a){},134:function(e,t,a){},135:function(e,t,a){},299:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(33),o=a(34),l=a(35),i=a(38),c=a(36),p=a(37);a(306);t.default=class extends r.Component{constructor(...e){super(...e),this.handleClick=(()=>{this.props.onTile(this.props.file)})}render(){const e=this.props.file,t=e.sequence,a=e.action,r=e.periode,u=e.fx,h=e.url,m=e.color,d=e.colorDistribution;return n.a.createElement(s.a,{className:"tpl-small",color:m,colorDistribution:d,onClick:this.handleClick},n.a.createElement(c.a,{url:h}),n.a.createElement("div",{className:"legend"},n.a.createElement("div",{className:"indicators"},n.a.createElement(o.a,{color:m,value:t}),n.a.createElement(l.a,{value:r}),n.a.createElement(p.a,{value:u})),n.a.createElement(i.a,{value:a})))}}},300:function(e,t,a){},301:function(e,t,a){},302:function(e,t,a){},303:function(e,t,a){},304:function(e,t,a){},305:function(e,t,a){},306:function(e,t,a){},307:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(33),o=a(34),l=a(35),i=a(38),c=a(36),p=a(37);a(308);t.default=class extends r.Component{constructor(...e){super(...e),this.handleClick=(()=>{this.props.onTile(this.props.file)})}render(){const e=this.props.file,t=e.sequence,a=e.action,r=e.periode,u=e.fx,h=e.url,m=e.color,d=e.colorDistribution;return n.a.createElement(s.a,{className:"tpl-large",color:m,colorDistribution:d,onClick:this.handleClick},n.a.createElement("div",{className:"img-container"},n.a.createElement(c.a,{url:h})),n.a.createElement("div",{className:"legend"},n.a.createElement("div",{className:"indicators"},n.a.createElement(o.a,{color:m,value:t}),n.a.createElement(l.a,{value:r}),n.a.createElement(p.a,{value:u})),n.a.createElement(i.a,{value:a})))}}},308:function(e,t,a){},309:function(e,t,a){},310:function(e,t,a){},311:function(e,t,a){},312:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(102),o=a.n(s),l=(a(128),a(17)),i=a(108),c=a.n(i);var p=class extends r.Component{render(){return n.a.createElement("header",{className:"App-header"},n.a.createElement("img",{src:c.a,className:"App-logo",alt:"logo"}),n.a.createElement("h1",{className:"App-title"},"Welcome to Photogram"),n.a.createElement("p",null,"This is the new Photogram"))}};a(132);var u=class extends r.Component{render(){return n.a.createElement("form",null,n.a.createElement("input",{type:"file",id:"new-project-file",webkitdirectory:(!0).toString(),directory:(!0).toString(),multiple:!0,onChange:e=>{this.props.onNewProject(e.target.files),e.target.form.reset()}}),n.a.createElement("label",{htmlFor:"new-project-file",id:"new-project-label"},"Nouveau projet"))}};a(133);var h=class extends r.Component{render(){return n.a.createElement("ul",{id:"grid"},this.props.value.map(e=>{let t,a=e.data[0];return a&&(t=a.url),n.a.createElement("li",{key:e.key},n.a.createElement(l.b,{to:"/project/"+e.key},n.a.createElement("div",{className:"picture"},n.a.createElement("img",{alt:"project cover",src:t})),n.a.createElement("span",null,e.name),n.a.createElement("button",{className:"btn-delete",onClick:t=>{t.preventDefault(),this.props.onDelete(e.key)}},"\u2715")))}))}};a(134);var m=class extends r.Component{humanFileSize(e){var t=0===e?0:Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}render(){return n.a.createElement("div",{className:"quota-progress-container"},n.a.createElement("span",null,"Utilisation de l'espace disque\xa0: "),n.a.createElement("progress",{max:this.props.max,value:this.props.value}),n.a.createElement("em",null,this.humanFileSize(this.props.value)," / ",this.humanFileSize(this.props.max)))}},d=a(118);function g(e,t,a){const r=new FileReader;return r.onerror=(()=>{r.abort(),t(new Error("Problem parsing input file."))}),r.onload=(()=>{e({file:a,result:r.result})}),r}var f=class{constructor(e){this.identifier=e}execute(e){let t=/^image\//;return Promise.all(Array.from(e).filter(e=>t.test(e.type)).map(e=>(function(e){return new Promise((t,a)=>{g(t,a,e).readAsArrayBuffer(e)})})(e))).then(e=>Promise.all(e.map(e=>this._writeFile(e))))}clear(){return caches.delete("image-cache-"+this.identifier)}_writeFile(e){return caches.open("image-cache-"+this.identifier).then(t=>{let a=new Headers;return a.append("Content-Type",e.file.type),a.append("Content-Length",e.file.size),t.put(new Request(`/project/${this.identifier}/images/${e.file.name}/`),new Response(e.result,{status:200,statusText:"From Cache",headers:a})).catch(e=>Promise.reject(e))}).then(t=>({name:e.file.name,url:`/project/${this.identifier}/images/${e.file.name}/`}))}},v=a(109),E=a.n(v);var C=class{execute(e){let t=Array.from(e).filter(e=>"data.csv"===e.name);return 0===t.length?Promise.reject(new Error("Could not found data.csv")):new Promise((e,a)=>E.a.parse(t[0],{complete:e,error:a})).then(e=>{var t=[];for(let a of e.data){const e=this.parseId(a[0]);null!==e&&t.push({id:e,sequence:e,action:a[1],place:(a[2]||"").trim(),periode:(a[3]||"").trim(),fx:a[4]})}return t})}parseId(e){if(void 0===e||null===e)return null;const t=e.trim();return null!==t.match(/^\d/)?t:null}};var y=class{constructor(){this.colors=["#F44336","#E91E63","#9C27B0","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548"]}list(){return Promise.resolve(this._projects)}get(e){let t=this._projects.filter(t=>t.key===e);return 0===t.length?Promise.reject(new Error(`Could not found project with id=${e}`)):Promise.resolve(t[0])}delete(e){var t=this._projects;let a=t.filter(t=>t.key!==e);if(a.length===t.length)return Promise.reject(new Error(`Could not found project with id=${e}`));try{return localStorage.setItem("projects",JSON.stringify(a)),Promise.resolve(a).then(new f(e).clear())}catch(r){return Promise.reject(r)}}update(e,t){return this.get(e).then(a=>{a.data=a.data.map(e=>e.id==t.id?{id:t.id,url:e.url,sequence:t.sequence,action:t.action,place:t.place,periode:t.periode,fx:t.fx}:e),t.place&&void 0===a.colors[t.place]&&(a.colors[t.place]=this.colors[Object.keys(a.colors).length]),this.save(e,a)})}updateColor(e,t){return this.get(e).then(a=>{Object.keys(t).forEach(e=>{a.colors[e]=t[e]}),this.save(e,a)})}save(e,t){const a=this._projects.map(e=>t.key==e.key?t:e);localStorage.setItem("projects",JSON.stringify(a))}add(e){var t=this._projects,a=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>((15&(e^crypto.getRandomValues(new Uint8Array(1))[0]))>>e/4).toString(16)),r=this._name(e,`Project (${t.length})`);return Promise.all([new f(a).execute(e),(new C).execute(e)]).then(e=>{let n=Object(d.a)(e,2),s=n[0],o=n[1];t.push({key:a,name:r,data:this._mergeDateWithImages(o,Array.from(s)),colors:this._calculateColors(o),type:"small"});try{return localStorage.setItem("projects",JSON.stringify(t)),t}catch(l){return Promise.reject(l)}})}get _projects(){return JSON.parse(localStorage.getItem("projects"))||[]}_mergeDateWithImages(e,t){return e.map(e=>{let a=t.filter(t=>t.name.startsWith(`${e.id}.`));return 0===a.length?e:Object.assign(e,{url:a[0].url})})}_calculateColors(e){let t=[...new Set(e.map(e=>e.place).filter(e=>null!==e&&""!==e))];return Object.assign({},...t.map((e,t)=>({[e]:this.colors[t]})))}_name(e,t){if(0===e.length)return t;let a=e[0].webkitRelativePath;if(a){let e=a.split("/")[0];if(e)return e}return t}};a(66);var b=class extends r.Component{constructor(e){super(e),this.state={projects:[],quotas:{max:0,value:0}},this.repository=new y}componentDidMount(){this._checkQuotas(),this.repository.list().then(e=>this.setState({projects:e}))}_checkQuotas(){navigator.storage.estimate().then(e=>this.setState(Object.assign(this.state,{quotas:{max:e.quota,value:e.usage}})))}onNewProject(e){this.repository.add(e).then(e=>this.setState({projects:e})).then(e=>this._checkQuotas()).catch(e=>console.log(e))}onDeleteProject(e){this.repository.delete(e).then(e=>this.setState({projects:e})).then(e=>this._checkQuotas()).catch(e=>console.log(e))}render(){return n.a.createElement("div",{className:"landing-container"},n.a.createElement(p,null),n.a.createElement(u,{onNewProject:e=>this.onNewProject(e)}),n.a.createElement(h,{value:this.state.projects,onDelete:e=>this.onDeleteProject(e)}),n.a.createElement(m,{value:this.state.quotas.value,max:this.state.quotas.max}))}},j=(a(135),a(110));class x extends r.Component{constructor(...e){super(...e),this.state={color:this.props.color,pickerVisible:!1},this.handleColorChange=((e,t)=>{this.setState({color:e.hex}),this.props.onChangeComplete(e,t)})}render(){return n.a.createElement("div",null,n.a.createElement("button",{onClick:()=>this.setState({pickerVisible:!this.state.pickerVisible}),style:{color:"transparent",backgroundColor:this.state.color}},">",this.state.color),this.state.pickerVisible&&n.a.createElement("div",{style:{position:"absolute",right:0}},n.a.createElement(j.SketchPicker,{color:this.state.color,onChangeComplete:this.handleColorChange})))}}var k=class extends r.Component{render(){return this.props.colors?n.a.createElement("table",{className:"colors"},Object.keys(this.props.colors).map(e=>n.a.createElement("tr",null,n.a.createElement("td",null,e),n.a.createElement("td",null,n.a.createElement(x,{color:this.props.colors[e],onChangeComplete:(t,a)=>{this.props.onColorChange({[e]:t.hex})}}))))):null}};var w=class extends r.Component{render(){return n.a.createElement("div",{className:"configuration"},n.a.createElement("h1",null,this.props.title),n.a.createElement("section",null,n.a.createElement("h2",null,"Layout"),n.a.createElement("select",{onChange:e=>this.props.onChange(e.target.value)},n.a.createElement("option",{value:"small"},"Small"),n.a.createElement("option",{value:"large"},"Large"))),n.a.createElement("section",null,n.a.createElement("h2",null,"Colors"),n.a.createElement("input",{id:"color-distribution",type:"checkBox",onChange:e=>this.props.onColorDistributionChange(e.target.checked)}),n.a.createElement("label",{htmlFor:"color-distribution"},"Background color"),n.a.createElement(k,{colors:this.props.colors,onColorChange:this.props.onColorChange})))}};var S=class extends r.Component{renderImage(){if(this.props.type)switch(this.props.type){case"small":let e=a(299).default;return n.a.createElement(e,{file:this.props.file,onTile:this.props.onTile});case"large":let t=a(307).default;return n.a.createElement(t,{file:this.props.file,onTile:this.props.onTile});default:return null}}render(){return this.renderImage()}};function N(e){let t=e.type;if(e.value){const a=e.value.map(a=>{let r;return r=a.place?Object.assign(a,{color:e.colors[a.place],colorDistribution:e.colorDistribution?"full":"limited"}):a,n.a.createElement(S,{key:a.id,type:t,file:r,onTile:t=>e.onTile(t)})});return n.a.createElement("div",null,a)}return null}a(309);var _=class extends r.Component{constructor(...e){super(...e),this.state={},this.handleSubmit=(e=>{e.preventDefault(),this.props.onSave(this.mergePropsWithState()),this.close()}),this.handleInputChange=(e=>{const t=e.target,a="checkbox"===t.type?t.checked:t.value,r=t.name;let n=void 0===this.state.data?{}:this.state.data;this.setState(e=>({data:Object.assign(n,{[r]:a})}))}),this.close=(e=>{this.setState({data:void 0},()=>console.log(this.state)),this.props.onCancel()}),this.handleClose=(e=>{e.preventDefault(),this.close()})}mergePropsWithState(){const e=void 0===this.state.data?{}:this.state.data,t=void 0===this.props.data?{}:this.props.data;return Object.assign({},t,e)}render(){if(void 0!==this.props.data){const e=this.mergePropsWithState(),t=e.sequence,a=e.action,r=e.periode,s=e.place,o=e.fx,l=e.url,i=Object.keys(void 0===this.props.colors?{}:this.props.colors).sort();return n.a.createElement("div",{className:"modal"+(this.props.data?" display":"")},n.a.createElement("form",{id:"form",className:"modal-content group ",onSubmit:this.handleSubmit},n.a.createElement("input",{id:"form-id",type:"hidden",name:"id",defaultValue:t,onChange:this.handleInputChange}),n.a.createElement("img",{id:"form-img",src:l}),n.a.createElement("input",{id:"form-sequence",name:"sequence",placeholder:"sequence",defaultValue:t,onChange:this.handleInputChange}),n.a.createElement("label",{htmlFor:"periode"},"Periode"),n.a.createElement("select",{id:"periode",name:"periode",defaultValue:r,onChange:this.handleInputChange},n.a.createElement("option",{value:""},"None"),n.a.createElement("option",{value:"matin"},"Morning"),n.a.createElement("option",{value:"soir"},"Evening"),n.a.createElement("option",{value:"jour"},"Day"),n.a.createElement("option",{value:"nuit"},"Night")),n.a.createElement("label",{htmlFor:"fx"},"Fx"),n.a.createElement("input",{id:"fx",name:"fx",type:"checkbox",checked:o,onChange:this.handleInputChange}),n.a.createElement("div",null,n.a.createElement("label",{htmlFor:"place"},"Place"),n.a.createElement("input",{id:"place",name:"place",placeholder:"New place",onChange:this.handleInputChange}),n.a.createElement("span",null,"or"),n.a.createElement("select",{id:"placeList",name:"place",value:s,onChange:this.handleInputChange},n.a.createElement("option",{key:"none",value:""},"None"),i.map(e=>n.a.createElement("option",{key:e,value:e},e)))),n.a.createElement("textarea",{id:"form-action",name:"action",placeholder:"action",rows:"4",onChange:this.handleInputChange,value:a}),n.a.createElement("button",{type:"submit",className:"md-button"},"Save"),n.a.createElement("button",{type:"button",className:"md-button",id:"form-close",onClick:this.handleClose},"Close")))}return n.a.createElement("div",{className:"modal"})}};a(310);var D=class extends r.Component{constructor(e){super(e),this.repository=new y,this.state={project:{},template:"small"}}componentDidMount(){this.loadData()}loadData(){this.repository.get(this.props.match.params.id).then(e=>{this.setState(Object.assign(this.state,{project:e}))}).catch(e=>console.log(e))}render(){return n.a.createElement("div",null,n.a.createElement(_,{data:this.state.data,colors:this.state.project.colors,onCancel:()=>this.setState(Object.assign(this.state,{data:void 0})),onSave:e=>this.repository.update(this.props.match.params.id,e).then(()=>this.loadData())}),n.a.createElement("div",{className:"layout-parent"},n.a.createElement(N,{className:"layout-left",colorDistribution:this.state.color_distribution,colors:this.state.project.colors,value:this.state.project.data,type:this.state.template,onTile:e=>this.setState(Object.assign(this.state,{data:e}))}),n.a.createElement(w,{title:this.state.project.name,colors:this.state.project.colors,onChange:e=>this.setState(Object.assign(this.state,{template:e})),onColorChange:e=>this.repository.updateColor(this.props.match.params.id,e).then(()=>this.loadData()),onColorDistributionChange:e=>this.setState(Object.assign(this.state,{color_distribution:e}))})))}};a(311);var F=class extends r.Component{render(){return n.a.createElement(l.a,null,n.a.createElement("div",{className:"App"},n.a.createElement(l.c,{exact:!0,path:"/",component:b}),n.a.createElement(l.c,{path:"/project/:id",component:D})))}};o.a.render(n.a.createElement(F,null),document.getElementById("root")),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/image-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})})},33:function(e,t,a){"use strict";var r=a(0),n=a.n(r);a(300);t.a=class extends r.Component{render(){let e;return e="full"===this.props.colorDistribution?this.props.color:null,n.a.createElement("div",{className:`ele ${this.props.className}`,style:{backgroundColor:e},onClick:this.props.onClick},this.props.children)}}},34:function(e,t,a){"use strict";var r=a(0),n=a.n(r);a(301);t.a=class extends r.Component{render(){const e=this.props.color;return n.a.createElement("span",{className:`sequence ${e?"sequence-colored":""}`,style:{background:e}},this.props.value)}}},35:function(e,t,a){"use strict";var r=a(0),n=a.n(r),s=a(111),o=a.n(s),l=a(112),i=a.n(l),c=a(113),p=a.n(c),u=a(114),h=a.n(u),m=a(115),d=a.n(m);a(101),a(302);t.a=class extends r.Component{render(){return n.a.createElement("img",{alt:"period",className:`dot period ${this._periodeToClassName(this.props.value)}`,src:this._periodeToSrc(this.props.value)})}_periodeToClassName(e){switch(this._toSingleLetter(e)){case"m":return"dot-light";case"s":return"dot-dark";case"j":return"dot-lighter";case"n":return"dot-darker";default:return"hide"}}_periodeToSrc(e){switch(this._toSingleLetter(e)){case"m":return p.a;case"s":return h.a;case"j":return i.a;case"n":return o.a;default:return d.a}}_toSingleLetter(e){return void 0===e||0===e.length?void 0:e.toLowerCase()[0]}}},36:function(e,t,a){"use strict";var r=a(0),n=a.n(r),s=(a(304),a(116)),o=a.n(s);t.a=class extends r.Component{render(){const e=this.props.url;return n.a.createElement("img",{className:"img",src:e||o.a,alt:"photogram"})}}},37:function(e,t,a){"use strict";var r=a(0),n=a.n(r),s=a(117),o=a.n(s);a(101),a(305);t.a=class extends r.Component{render(){return n.a.createElement("img",{className:`dot dot-green fx ${this.props.value?"":"hide"}`,src:o.a,alt:"special effects indicator"})}}},38:function(e,t,a){"use strict";var r=a(0),n=a.n(r),s=class{constructor(e,t){this.min=e,this.max=t}apply(e){e.style.fontSize=this.max+"rem",this._hasOverflow(e.parentNode)&&(e.style.fontSize=this.min+"rem",this._hasOverflow(e.parentNode)||this._recApplyFontSize(e,this.min,this.max))}_recApplyFontSize(e,t,a){var r=t+(a-t)/2;e.style.fontSize=r+"rem",this._hasOverflow(e.parentNode)?this._recApplyFontSize(e,t,r):a-t>.05&&this._recApplyFontSize(e,r,a)}_hasOverflow(e){return e.scrollHeight>e.clientHeight}};a(303);t.a=class extends r.Component{constructor(e){super(e),this.textNode=n.a.createRef(),this.fontSizeAdjuster=new s(.2,2)}componentDidUpdate(e,t){this.fontSizeAdjuster.apply(this.textNode.current)}componentDidMount(){this.fontSizeAdjuster.apply(this.textNode.current)}render(){return n.a.createElement("div",{className:"action-container"},n.a.createElement("p",{className:"action",ref:this.textNode},this.props.value))}}},66:function(e,t,a){}},[[119,1,2]]]);
//# sourceMappingURL=main.e03e4dc6.chunk.js.map